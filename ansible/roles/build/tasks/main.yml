---
# tasks file for build
- block:
    - name: Copy docker files to remote server
      copy:
        src: "{{ item }}"
        dest: "{{ docker_files_dest }}"
        mode: preserve
      loop:
        - .

    - name: Tear down and clear old docker files
      community.docker.docker_compose:
        project_src: "{{ docker_files_dest }}"
        state: absent
    - name: prune volume
      shell:
        cmd: docker volume prune -af

    - name: Set permission to docker compose
      shell:
        cmd: chmod +x {{ docker_files_dest }}/compose.yml

    - name: Build docker compose
      community.docker.docker_compose:
        project_src: "{{ docker_files_dest }}"
        build: true
        state: present

  when: ansible_os_family == "Debian"
